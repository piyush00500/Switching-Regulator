<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Switching Regulator Visualizer — Buck / Boost</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#60a5fa; --muted:#94a3b8; --bg-2:#071028;
      --glow: 0 8px 30px rgba(96,165,250,0.08);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),var(--bg-2));color:#e6eef8}
    .wrap{max-width:1100px;margin:28px auto;padding:20px;display:grid;grid-template-columns:420px 1fr;gap:20px}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;box-shadow:var(--glow);border:1px solid rgba(255,255,255,0.03)}
    h1{font-size:20px;margin:0 0 8px}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    /* Controls */
    .controls{display:grid;gap:12px;margin-top:14px}
    label{font-size:12px;color:var(--muted);display:flex;justify-content:space-between;align-items:center}
    input[type=range]{width:100%;accent-color:var(--accent)}
    .value{font-weight:600;color:#fff;font-size:13px}
    .mode-toggle{display:flex;gap:8px;margin-top:8px}
    .mode-toggle button{flex:1;padding:8px;border-radius:8px;border:0;background:transparent;color:var(--muted);cursor:pointer}
    .mode-toggle button.active{background:rgba(96,165,250,0.12);color:var(--accent)}

    /* Canvas area */
    .visual{padding:18px;display:flex;flex-direction:column;gap:12px}
    .circuit-area{height:320px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-radius:10px;padding:16px;position:relative}

    svg{width:100%;height:100%}
    .comp{cursor:pointer}
    .tooltip{position:absolute;pointer-events:none;transform:translate(-50%,-100%);background:rgba(6,8,15,0.9);padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);font-size:13px;color:#dfe8fb;white-space:nowrap;display:none}

    /* simple waveform */
    .wave{height:120px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-radius:8px;padding:8px}
    canvas.waveform{width:100%;height:100%;display:block}

    .footer{margin-top:8px;font-size:12px;color:var(--muted)}

    /* small legend */
    .legend{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .legend .item{display:flex;gap:8px;align-items:center;color:var(--muted);font-size:13px}
    .legend .dot{width:14px;height:8px;border-radius:3px}

    /* responsive */
    @media (max-width:980px){.wrap{grid-template-columns:1fr;max-width:720px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <h1>Switching Regulator Visualizer</h1>
      <p class="lead">Interactive demo showing how duty cycle &amp; frequency affect a switching regulator (buck &amp; boost). Hover components for tooltips. Adjust load and mode.</p>

      <div class="controls">
        <div>
          <label>Mode <span id="modeLabel" class="value">Buck</span></label>
          <div class="mode-toggle" role="tablist">
            <button id="modeBuck" class="active" aria-pressed="true">Buck</button>
            <button id="modeBoost">Boost</button>
          </div>
        </div>

        <div>
          <label>Duty cycle <span id="dutyVal" class="value">50%</span></label>
          <input id="duty" type="range" min="1" max="99" value="50">
        </div>

        <div>
          <label>Switch frequency <span id="freqVal" class="value">50 kHz</span></label>
          <input id="freq" type="range" min="5" max="200" value="50">
        </div>

        <div>
          <label>Load (Ohms) <span id="loadVal" class="value">10 Ω</span></label>
          <input id="load" type="range" min="1" max="100" value="10">
        </div>

        <div class="footer">Tip: change duty cycle to see how average output follows D·Vin (buck) or Vin/(1-D) (boost) approximately.</div>
      </div>
    </div>

    <div class="panel visual">
      <div class="circuit-area" id="area">
        <div id="tooltip" class="tooltip"></div>
        <!-- circuit SVG -->
        <svg viewBox="0 0 900 520" id="svg">
          <!-- Ground symbol -->
          <defs>
            <linearGradient id="g1" x1="0" x2="1">
              <stop offset="0" stop-color="#60a5fa" stop-opacity="0.9"></stop>
              <stop offset="1" stop-color="#7dd3fc" stop-opacity="0.3"></stop>
            </linearGradient>
          </defs>

          <!-- Vin -->
          <g transform="translate(40,60)">
            <rect x="0" y="0" width="110" height="60" rx="8" fill="rgba(255,255,255,0.03)" stroke="rgba(255,255,255,0.04)" />
            <text x="18" y="36" fill="#dfe8fb" font-size="14">Vin = <tspan id="vinText">12 V</tspan></text>
          </g>

          <!-- wiring and components for Buck (initial layout) -->
          <!-- Switch (MOSFET) -->
          <g id="switch" class="comp" transform="translate(200,70)" data-title="Switch (MOSFET)\nCloses when gate is high to connect Vin to inductor.">
            <rect x="0" y="0" width="80" height="40" rx="6" fill="#07182b" stroke="rgba(96,165,250,0.14)"/>
            <text x="10" y="25" font-size="13" fill="#9fbecf">SW</text>
            <circle cx="40" cy="-16" r="6" id="gateLed" fill="#18324b" stroke="#10304a" />
          </g>

          <!-- Inductor -->
          <g id="inductor" class="comp" transform="translate(330,58)" data-title="Inductor\nSmooths current; stores energy when switch is ON and releases when OFF.">
            <rect x="0" y="0" width="120" height="60" rx="8" fill="#071822" stroke="rgba(255,255,255,0.03)"/>
            <text x="12" y="33" font-size="13" fill="#cfe9ff">L</text>
            <!-- coil visual -->
            <g transform="translate(50,10)">
              <path d="M-40 20 q8 -24 20 0 q8 -24 20 0 q8 -24 20 0 q8 -24 20 0" fill="none" stroke="url(#g1)" stroke-width="4" stroke-linecap="round" />
            </g>
          </g>

          <!-- Diode (for Buck) -->
          <g id="diode" class="comp" transform="translate(300,140)" data-title="Diode (Freewheel)\nProvides path for current when switch is OFF.">
            <path d="M0 10 L40 10 L40 0 L80 20 L40 40 L40 30 L0 30 Z" fill="#0b2030" stroke="#214b66" />
            <text x="90" y="27" font-size="13" fill="#bcdff7">D</text>
          </g>

          <!-- Capacitor & Load -->
          <g id="capload" class="comp" transform="translate(520,70)" data-title="Capacitor & Load\nCapacitor smooths output voltage. Load draws current (R).">
            <rect x="0" y="0" width="140" height="60" rx="8" fill="#071521" stroke="rgba(255,255,255,0.03)"/>
            <text x="12" y="20" font-size="12" fill="#dbeeff">C</text>
            <rect x="12" y="28" width="18" height="18" rx="3" fill="#0e2a3d" stroke="#173c50" />
            <text x="36" y="44" font-size="12" fill="#bcdff7">R = <tspan id="rText">10</tspan> Ω</text>
          </g>

          <!-- Wires -->
          <g stroke="#2b536a" fill="none" stroke-width="3">
            <path id="w1" d="M150 90 L200 90" />
            <path id="w2" d="M280 90 L330 90" />
            <path id="w3" d="M450 90 L520 90" />
            <path id="w4" d="M660 120 L760 120" />
          </g>

          <!-- Output Voltage meter -->
          <g transform="translate(700,20)">
            <rect x="0" y="0" width="160" height="80" rx="8" fill="#071422" stroke="rgba(255,255,255,0.03)"/>
            <text x="12" y="28" font-size="12" fill="#bde3ff">Vout</text>
            <text id="voutText" x="12" y="54" font-size="22" fill="#fff">6.0 V</text>
          </g>

        </svg>
      </div>

      <div class="wave">
        <canvas id="waveCanvas" class="waveform"></canvas>
      </div>

      <div class="legend">
        <div class="item"><div class="dot" style="background:linear-gradient(90deg,#60a5fa,#7dd3fc)"></div>Switch waveform</div>
        <div class="item"><div class="dot" style="background:linear-gradient(90deg,#fca5a5,#fb7185)"></div>Inductor current</div>
        <div class="item"><div class="dot" style="background:linear-gradient(90deg,#bbf7d0,#34d399)"></div>Output voltage</div>
      </div>
    </div>
  </div>

  <script>
    // Elements
    const duty = document.getElementById('duty');
    const freq = document.getElementById('freq');
    const load = document.getElementById('load');
    const dutyVal = document.getElementById('dutyVal');
    const freqVal = document.getElementById('freqVal');
    const loadVal = document.getElementById('loadVal');
    const modeBuck = document.getElementById('modeBuck');
    const modeBoost = document.getElementById('modeBoost');
    const modeLabel = document.getElementById('modeLabel');
    const gateLed = document.getElementById('gateLed');
    const voutText = document.getElementById('voutText');
    const rText = document.getElementById('rText');

    // Tooltip
    const area = document.getElementById('area');
    const tooltip = document.getElementById('tooltip');
    document.querySelectorAll('.comp').forEach(el=>{
      el.addEventListener('mousemove', (e)=>{
        const title = el.dataset.title || el.getAttribute('data-title');
        if(!title) return;
        tooltip.style.left = e.offsetX + 'px';
        tooltip.style.top = e.offsetY + 'px';
        tooltip.innerText = title.replace(/\\n/g,'\n');
        tooltip.style.display = 'block';
      });
      el.addEventListener('mouseleave', ()=>tooltip.style.display='none');
    });

    // Canvas waveform
    const canvas = document.getElementById('waveCanvas');
    const ctx = canvas.getContext('2d');
    function resize(){canvas.width = canvas.clientWidth*devicePixelRatio; canvas.height = canvas.clientHeight*devicePixelRatio; ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0)}
    window.addEventListener('resize', resize); resize();

    // Simulation parameters
    const Vin = 12; // fixed for demo
    let D = +duty.value/100;
    let f = +freq.value * 1000; // Hz
    let R = +load.value;
    let mode = 'buck';

    function updateUI(){
      dutyVal.innerText = Math.round(D*100) + '%';
      freqVal.innerText = Math.round(f/1000) + ' kHz';
      loadVal.innerText = R + ' Ω';
      rText.innerText = R;
      modeLabel.innerText = mode.charAt(0).toUpperCase()+mode.slice(1);
    }

    duty.addEventListener('input', ()=>{D = +duty.value/100; updateUI()});
    freq.addEventListener('input', ()=>{f = +freq.value*1000; updateUI()});
    load.addEventListener('input', ()=>{R = +load.value; updateUI()});

    modeBuck.addEventListener('click', ()=>{mode='buck';modeBuck.classList.add('active');modeBoost.classList.remove('active');updateUI();});
    modeBoost.addEventListener('click', ()=>{mode='boost';modeBoost.classList.add('active');modeBuck.classList.remove('active');updateUI();});

    updateUI();

    // Simple time-based simulation for visualization: switch waveform, a smoothed inductor current, and output voltage
    let t = 0; // seconds
    let last = performance.now();

    function simStep(dt){
      // dt in seconds
      // produce a square wave for switch (1 when on)
      const period = 1/f;
      const phase = (t % period)/period;
      const sw = (phase < D) ? 1 : 0;

      // quick approximate relationships (NOT a SPICE simulation):
      // Buck: Vout ~= D * Vin (ideal)
      // Boost: Vout ~= Vin / (1 - D)
      let Vout_ideal;
      if(mode==='buck') Vout_ideal = D*Vin;
      else Vout_ideal = Vin/(1 - D + 1e-6);

      // add load and smoothing: capacitor & inductor effect -> low-pass filtered Vout
      // We'll simulate a simple RC low-pass where time constant depends on R and a fixed C
      const C = 220e-6; // 220uF
      const tau = R*C; // seconds
      // simple exponential approach to ideal
      if(!window.Vout_display) window.Vout_display = Vout_ideal;
      const alpha = 1 - Math.exp(-dt/Math.max(tau,0.00001));
      window.Vout_display += (Vout_ideal - window.Vout_display)*alpha;

      // Inductor current visual (approx): i = (Vin - Vout)/L * on/off integrated -> we'll just show a smoother waveform
      const L = 47e-6; // 47uH
      if(!window.iL) window.iL = (Vout_ideal/R);
      // when switch ON, di/dt = (Vin - Vout)/L; OFF di/dt = (0 - Vout)/L (buck mode) - approximate
      const vL_on = (mode==='buck') ? (Vin - window.Vout_display) : (Vin - window.Vout_display);
      const vL_off = (mode==='buck') ? (-window.Vout_display) : (Vin - window.Vout_display);
      const vL = sw? vL_on : vL_off;
      window.iL += (vL/L)*dt;
      // basic damping from load
      window.iL *= Math.exp(-dt* (1/(R*C)));

      // gate LED animation
      gateLed.setAttribute('fill', sw? '#3ee6a1' : '#18324b');

      // update displayed Vout
      voutText.innerText = window.Vout_display.toFixed(2) + ' V';

      // waveform buffer update
      pushWave({sw, i: window.iL, v: window.Vout_display});

      t += dt;
    }

    // waveform buffer
    const bufferSize = 800;
    const buffer = [];
    function pushWave(sample){ if(buffer.length>=bufferSize) buffer.shift(); buffer.push(sample); }

    function drawWave(){
      const w = canvas.clientWidth; const h = canvas.clientHeight;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.save();
      ctx.scale(1,1);

      // background grid
      ctx.globalAlpha = 0.08;
      ctx.fillStyle = '#ffffff';
      for(let x=0;x<w;x+=40){ctx.fillRect(x,0,1,h)}
      for(let y=0;y<h;y+=20){ctx.fillRect(0,y,w,1)}
      ctx.globalAlpha = 1;

      // draw switch waveform (top)
      ctx.beginPath();
      for(let i=0;i<buffer.length;i++){
        const x = (i / bufferSize) * w;
        const y = 8 + (buffer[i].sw? 0 : 28);
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      }
      ctx.lineWidth = 2; ctx.strokeStyle = 'rgba(96,165,250,0.95)'; ctx.stroke();

      // draw inductor current (middle)
      ctx.beginPath();
      for(let i=0;i<buffer.length;i++){
        const x = (i / bufferSize) * w;
        const val = buffer[i].i || 0;
        const normalized = 40 - Math.tanh(val/2)*18; // clamp
        const y = 40 + normalized;
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      }
      ctx.lineWidth = 2; ctx.strokeStyle = 'rgba(251,113,133,0.95)'; ctx.stroke();

      // draw Vout (bottom)
      ctx.beginPath();
      for(let i=0;i<buffer.length;i++){
        const x = (i / bufferSize) * w;
        const val = buffer[i].v || 0;
        const normalized = (1 - Math.min(val / (Vin*2),1)) * 40; // scale
        const y = h - 12 - normalized;
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      }
      ctx.lineWidth = 2; ctx.strokeStyle = 'rgba(107,255,168,0.95)'; ctx.stroke();

      // small labels
      ctx.fillStyle = '#d7e9ff'; ctx.font = '11px sans-serif';
      ctx.fillText('Switch',8,12); ctx.fillText('Inductor I',8,36); ctx.fillText('Vout',8,h-6);

      ctx.restore();
    }

    // main loop
    function loop(now){
      const dt = Math.min(0.06, (now - last)/1000);
      last = now;
      simStep(dt);
      drawWave();
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);

    // initial buffer fill
    for(let i=0;i<bufferSize;i++) pushWave({sw:0,i:0,v:Vin*0.5});

    // Accessibility: keyboard control
    document.addEventListener('keydown', (e)=>{
      if(e.key==='ArrowUp') duty.value = Math.min(99, +duty.value + 1), duty.dispatchEvent(new Event('input'));
      if(e.key==='ArrowDown') duty.value = Math.max(1, +duty.value - 1), duty.dispatchEvent(new Event('input'));
    });

    // initial values
    updateUI();

  </script>
</body>
</html>
